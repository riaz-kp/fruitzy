
{% extends 'user/base.html' %}
{% load static %}

{% block content %}

<div class="container my-5">
    <h2 class="text-center mb-4">Shopping Cart</h2>
    
    <table class="table table-bordered text-center">
        <thead class="bg-success text-white">
            <tr>
                <th>Product</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Total</th>
                <th>Remove</th>
            </tr>
        </thead>
        <tbody>
            {% for item in cart_items %}
            <tr>
                <td>
                    <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" width="50">
                    <br> <strong>{{ item.product.product_name }}</strong>
                    <p>{{ item.product.description }}</p>
                </td>
                <td>${{ item.product.price }}</td>
                <td>
                    <!-- <form method="POST" action="{% url 'update_cart' item.id %}"> -->
                        {% csrf_token %}
                        <!-- <input type="number" name="quantity" value="{{ item.quantity }}" min="1" max="100" class="form-control text-center"> -->
                        <!-- <button type="submit" class="btn btn-primary btn-sm mt-1">increment</button>
                        <button type="submit" class="btn btn-primary btn-sm mt-1">decrement</button> -->
                        <div class="input-group">
                            <button class="btn btn-outline-secondary decrement-btn" data-item-id="{{ item.id }}" onclick="updateCart('{{ item.id }}', 'decrement')">
                                <i class="fas fa-minus"></i>
                            </button>
                            
                            <input style="max-width: 100px;" type="text" id="quantity_{{ item.id }}" value="{{ item.quantity }}" class="form-control text-center" readonly>
                            
                            <button class="btn btn-outline-secondary increment-btn" data-item-id="{{ item.id }}" onclick="updateCart('{{ item.id }}', 'increment')">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                    <!-- </form> -->
                </td>
                <td>${{ item.product.price|floatformat:2 }}</td>
                <td>
                    <a href="{% url 'remove_cart_item' item.id %}" class="btn btn-danger">Ã—</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="row mt-4">
        <div class="col-md-4">
            <h5>Cart Totals</h5>
            <ul class="list-group">
                <!-- <li class="list-group-item">Subtotal: ${{ subtotal|floatformat:2 }}</li> -->
                <!-- <li class="list-group-item">Discount: ${{ discount|floatformat:2 }}</li> -->
                <li class="list-group-item font-weight-bold">Total: ${{ cart_total|floatformat:2 }}</li>
            </ul>
            <a href="{% url 'checkout' %}" class="btn btn-success btn-block mt-2">Proceed to Checkout</a>
        </div>
    </div>
</div>
{% endblock %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    
   function updateCart(itemId, action) {
    let quantityInput = document.querySelector(`#quantity_${itemId}`);
    let currentQuantity = parseInt(quantityInput.value);

    if (action === "increment") {
        currentQuantity += 1;
    } else if (action === "decrement" && currentQuantity > 1) {
        currentQuantity -= 1;
    }

    console.log(itemId,quantity)
    axios.post("{% url 'update_cart_item' %}", {
        item_id: itemId,
        quantity: currentQuantity
    }, {
        headers: { "X-CSRFToken": "{{ csrf_token }}" }
    })
    .then(response => {
        if (response.data.success) {
            quantityInput.value = currentQuantity;
            document.querySelector(`#total_price_${itemId}`).innerText = `$${response.data.item_total}`;
            document.querySelector("#cart_total").innerText = `$${response.data.cart_total}`;
        }
    })
    .catch(error => {
        console.error("Error updating cart:", error);
    });
}

</script>